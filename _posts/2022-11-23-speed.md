---
layout: post
title: Visualization Demo
---


# CMPT732 Final Project Analysis

##### Yiwen Wang [ywa422]

## 1. ETL

+ **Initial ETL**

This part of ETL is suitable for all four subjects analysis.

| Column       | filter                                       | Remark                                                       |
| ------------ | -------------------------------------------- | ------------------------------------------------------------ |
| Time span    | 2017-2021                                    | We only focus on the near 5 years of data.                   |
| Car type     | Yellow and Green Cab                         | Yellow cabs are allowed to pick up passengers anywhere in the city. Green cabs can only pickup passengers from Bronx, Staten Island, Brooklyn, Queens(excluding airports), and Northern Manhattan. |
| Payment type | Cash and Credit card                         | Only payments with credit card have record of tip amount.    |
| Total amount | Total payment amount greater or equal to 2.5 | The initial price of NYC taxi is 2.5 dollars.                |

+ **Speed Subject ETL**

  + **Trip distance**

    This is an original data offered by the dataset, I only preserve trip distance greater than 0.

  + **Pickup and Dropoff Zone**

    The Location ID offered by the original dataset has unknown zone of 264 and 265, I only preserve data with identified pickup and drop off location.

    <img src="D:\2022秋季学期\732Lab\final project\nyc_cab_code\new-york-city-taxi-speed-explore\new-york-city-taxi-speed-explore\figure\zone.png" alt="zone" style="zoom:50%;" />

  + **Duration**

    The duration column is generated by the pickup and dropoff time difference in seconds. From the histogram of duration's frequency, a major range of duration  between 0 to 100 minutes is observed. The final duration I kept is 180min in case of special long taxi drives. 

    <img src="D:\2022秋季学期\732Lab\final project\nyc_cab_code\new-york-city-taxi-speed-explore\new-york-city-taxi-speed-explore\figure\duration.png" alt="duration" style="zoom:50%;" />

  + **Weekday and Hour** 

    The weekday and hour column are generated by extracting them from the pickup datetime column. 

  + **Speed**

    The speed column is generated by trip distance( in kilometer) divides duration( in hour). From the histogram of speed's frequency, a major range of speed between 0 and 60km/h is observed. The speed limit in nyc is 55mph, which is approximately 88.51km/h. The final speed I kept is 0 to 100km/h.

    <img src="D:\2022秋季学期\732Lab\final project\nyc_cab_code\new-york-city-taxi-speed-explore\new-york-city-taxi-speed-explore\figure\speed.png" alt="speed" style="zoom: 60%;" />

## 2. What's the pace of the city?

If we think of a city as a living creature, and roads as veins, then traffics are the blood cells busily running through the veins. By carefully looking at the taxies running record, we can unveil some nature of the dynamic of New York City. 

### 2.1 Rush hours

+ **Question: **Does different hours of a day and different day of a week affect the speed of the traffics? 

+ **Perspective**: If I am a customer who wants to grab a cab to work, I would probably want to know that how bad the traffic is going to be during the commuting peak hours. If I am a the city manager, I would want to know what are the traffic loads of each hours.

+ **Analysis**: I calculate the average speed of all the records in each hour and every day of a week. To see make the map easier to see, I convert all floats number to integers.

  + The heatmap below clearly shows a darker out ring and a lighter center square. This means that New York City is most busy from Wednesday to Saturday from 8:00 to 18:00. 
  + Taxi drivers tend to drive faster at night, especially before dawn, which corresponds to our common sense that most people are sleeping at that time so the roads are less busy. 
  + There is a pattern of gradient change when we see vertically from Tuesday to Saturday. But Sunday and Monday have a right shift of this pattern, which means a later rush hour and a later speed peak within a day as if the city is postponing its bedtime and then waking up later. 

  <img src="D:\2022秋季学期\732Lab\final project\nyc_cab_code\new-york-city-taxi-speed-explore\new-york-city-taxi-speed-explore\figure\figure\24hour_heatmap_5_years.png" alt="24hour_heatmap_5_years" style="zoom: 67%;" />

### 2.2 Zone Speed

+ **Question**: What is average taxi speed in each borough?

+ **perspective**: If I am the city manager,  I would want to know the traffic load in different parts of the city. If the average speed in one zone is pretty slow, than maybe better traffic planning should be taken into agenda.

+ **Analysis**: I firstly calculate the total amount of taxi record from one borough to another, and then calculate the average speed between each borough. 

  The original dataset split New York City into 6 zones, which are the traditional 5 boroughs plus the New Wark Library International Airport (EWR). I draw chord diagrams of both average speed and total commute times. From the total commute times diagram, we can easily see that taxi trips mostly occur within Manhattan city, which reasonably corresponds to the lowest average speed within Manhattan. The flow of Brooklyn and Queens also stand out in the chord diagram, which corresponds to the second and seventh slowest average speed within the borough. The city manager would probably want to keep an eye on the heavy traffic flow within these boroughs. Staten Island, on the other hand, is relatively a great place to travel from and to, it is involved in 4 of 5 top average speeds. 

  <img src="D:\2022秋季学期\732Lab\final project\chord combine.png" alt="chord combine" style="zoom:50%;" />

<img src="D:\2022秋季学期\732Lab\final project\scatter plot.png" alt="scatter plot" style="zoom:72%;" />

+ **Question**: How about each zone? What is the average speed within each zone？

+ **Analysis**: The original dataset furtherly split New York City into 263 known zones. I calculate the average speed within each zone and generate a heatmap of speed.

  From map below, it is easily to see that the whole Manhattan is in dark blue color, which indicates low speed. And central Brooklyn and central Queens are also relatively dark in blue. The Borough Park (zone 26) zone is with the darkest blue color in Brooklyn Borough, although by looking up in Google, the most busy street in Brooklyn does not lies in this zone. The city managers may want to figure out a better traffic management design for this zone. Staten Island, which is away from the busy part of New York City, with its parks and natural spaces, has the highest average speed among the city. Though in a bottom part of it is dark blue, which refers to the whole area of the Great Kill Park, I believe taxies rarely enter this place thus leads to the deviation of average speed from other part of the borough.

  <img src="D:\2022秋季学期\732Lab\final project\pd_map.png" alt="pd_map" style="zoom:35%;" />

### 2.3 Speed Prediction

+ **Question**: What is the speed when I want to grab a cab from one zone to another?
+ **Perspective**: Customers and Taxi drivers could both care much about speed. Customers may be in a hurry, while drivers always want to get more business as possible in a certain amount of time. The traffic condition also affects the mood of both customers and drivers either, if the traffic is bad and there is traffic congestion on the way, it won't be a very pleasant trip.
+ **Analysis**: To build a regression model which takes at least the pickup, dropoff location, and time as inputs and average speed of the ride as output.

#### 2.3.1 Feature Engineering

Before I really feed something into a model, I want to make sure this information is relevant to speed. The best way to check this is to do the correlation check or draw some scatter plots.

+ **Time**: From the 24/7 heatmap, we can see there is an obvious correlation between the time period and the speed. But here I want to separately check whether the hour and day of the week affect the speed.
  + **hour**: The scatter plot shows a wave-like pattern of dots, this means the range of most taxis' speed is changing from hour to hour.

<img src="D:\2022秋季学期\732Lab\final project\nyc_cab_code\new-york-city-taxi-speed-explore\new-york-city-taxi-speed-explore\figure\figure\hour_speed.png" alt="hour_speed" style="zoom:67%;" />

+ **weekday**: The pattern of weekday-speed is not as obvious as hour-speed, this probably means weekday alone doesn't affect speed that much. But considering the right shift in the heatmap during Saturday and Monday, I think weekday is offering some useful information when predicting speed. 

  <img src="D:\2022秋季学期\732Lab\final project\nyc_cab_code\new-york-city-taxi-speed-explore\new-york-city-taxi-speed-explore\figure\figure\weekday_speed.png" alt="weekday_speed" style="zoom:67%;" />

+ **Location**: The location of city is out of question a relevant feature. This is one of the most important information the original data set offer. But we don't want the Location ID as the feature, because it won't tell the model the relative position of each zone, instead we get the exact longitude and latitude of each zone. 

+ **weather**: The original dataset does not contain any information about weather, thus I found a data set contained the temperature and precipitation information of 2019 from Kaggle. (https://www.kaggle.com/datasets/alejopaullier/new-york-city-weather-data-2019) I choose the average temperature, rain and snow condition as input features. 

+ **traffic flow**: This is information is also not directly given in the original dataset. But since traffic flow is proportional to the total count  taxi drive records from one zone to another in a time period, an feature consist of the traffic flow could be pre-calculated and joined to the original dataset. To think furtherly, the heavier the traffic flow the slower the speed, thus there is a negative linear relationship between traffic flow and average speed. And the Pearson correlation coefficient between traffic flow and speed is -0.21, which proves our intuition.

<img src="D:\2022秋季学期\732Lab\final project\freq_speed.png" alt="freq_speed" style="zoom:72%;" />

### 2.3.2 Model Building

Model 
